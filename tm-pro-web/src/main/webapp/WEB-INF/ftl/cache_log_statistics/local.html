<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- BootStrap Css -->
<link href="${rc.contextPath}/statics/ui-frame/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
<!-- 字体图标 Css -->
<link href="${rc.contextPath}/statics/ui-frame/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
<!-- BootStrap 日期插件 -->
<link href="${rc.contextPath}/statics/ui-frame/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<!-- Css 动画 -->
<link href="${rc.contextPath}/statics/ui-frame/css/animate.min.css" rel="stylesheet">
<!-- 基本样式 -->
<link href="${rc.contextPath}/statics/ui-frame/css/style.min862f.css?v=4.1.0" rel="stylesheet">
</head>
<body class="gray-bg">
	<div id="app" class="wrapper wrapper-content" style="padding: 20px">
		<div class="row">
			<div class="col-sm-12">

				<div class="ibox float-e-margins">
					<div class="ibox-content">
						<div class="row">

							<div class="col-xs-2">
								<div class="form-group">
									<label class="font-noraml">开始日期</label>
					                <div class='input-group'>
					                    <input type='text' class="form-control" id="startDate"/>
					                </div>
					            </div>
							</div>
							<div class="col-xs-2">
								<div class="form-group">
									<label class="font-noraml">结束日期</label>
					                <div class='input-group'>
					                    <input type='text' class="form-control" id="endDate"/>
					                </div>
					            </div>
							</div>

							<div class="col-xs-2">
								<div class="form-group">
									<label class="font-noraml">厂商</label>
                                    <select class="form-control" name="manufacturer">
										<#list manufacturers as item>
                                       		<option value="${item.value!}">${item.name!}</option>
                                        </#list>
                                    </select>
								</div>
							</div>
							
							<div class="col-xs-2">
								<div class="form-group">
									<label class="font-noraml">类型</label>
									<select class="form-control" name="type">
										<#list requestHttpUrlTypes as item>
                                       		<option value="${item.value!}">${item.name!}</option>
                                        </#list>
                                    </select>
								</div>
							</div>
							
							<div class="col-xs-2">
								<div class="form-group">
									<label class="font-noraml">节点</label>
									<select class="form-control" id="city">
										<#list cacheSystemCitys as item>
											<option value="${item.value!}">${item.name!}</option>
                                        </#list>
                                    </select>
								</div>
							</div>
							
							<div class="col-xs-2">
								<div class="form-group" style="min-width: 120px;">
									<label class="font-noraml">操作</label>
									<div class="btn-group" style="display: block;">
										<button class="btn btn-primary" id="searchBtn" type="button">检索数据</button>
                                    </div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="row">
			<div class="col-xs-6">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>Cache状态码分布</h5>
						<div class="ibox-tools">
							<a style="color:#273a4a" id="downChart1"> <i class="fa fa-download"></i> 导出</a>
						</div>
					</div>
					<div class="ibox-content" style="padding-left: 0; padding-right: 0;">
						<div id="c1"><p style='line-height: 315px;text-align: center;'>无数据</p></div>
					</div>
				</div>
			</div>
			<div class="col-xs-6">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>回源吐出速率</h5>
						<div class="ibox-tools">
							<a style="color:#273a4a" id="downChart2"> <i class="fa fa-download"></i> 导出</a>
						</div>
					</div>
					<div class="ibox-content" style="padding-left: 0; padding-right: 0;">
						<div id="c2"><p style='line-height: 315px;text-align: center;'>无数据</p></div>
					</div>
				</div>
			</div>
			<div class="col-xs-6">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>Cache HIT/MISS/ERR比例</h5>
						<div class="ibox-tools">
							<a style="color:#273a4a" id="downChart3"> <i class="fa fa-download"></i> 导出</a>
						</div>
					</div>
					<div class="ibox-content" style="padding-left: 0; padding-right: 0;">
						<div id="c3"><p style='line-height: 255px;text-align: center;'>无数据</p></div>
					</div>
				</div>
			</div>
			<div class="col-xs-6">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>Cache 访问次数 (5分钟)</h5>
						<div class="ibox-tools">
							<a style="color:#273a4a" id="downChart4"> <i class="fa fa-download"></i> 导出</a>
						</div>
					</div>
					<div class="ibox-content" style="padding-left: 0; padding-right: 0;">
						<div id="c4"><p style='line-height: 255px;text-align: center;'>无数据</p></div>
					</div>
				</div>
			</div>
		</div>
		
	</div>
	<!-- Jquery Dom -->
	<script src="${rc.contextPath}/statics/ui-frame/js/jquery.min.js?v=2.1.4"></script>
	<!-- BootStrap Js -->
	<script src="${rc.contextPath}/statics/ui-frame/js/bootstrap.min.js?v=3.3.6"></script>
	<!-- 日期格式化插件 -->
	<script src="${rc.contextPath}/statics/ui-frame/plugins/moment/moment.min.js"></script>
	<script src="${rc.contextPath}/statics/ui-frame/plugins/moment/locale/zh-cn.js"></script>
	<!-- 日期插件 -->
	<script src="${rc.contextPath}/statics/ui-frame/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<!-- 框架工具 -->
	<script src="${rc.contextPath}/statics/ui-frame/js/frame-util.js"></script>
	<!-- 图表插件 -->
	<script src="${rc.contextPath}/statics/ui-frame/plugins/antv/antv-g2-v2.3.13.js"></script>
	<script src="${rc.contextPath}/statics/ui-frame/plugins/antv/slider.js"></script>
	<script type="text/javascript">
		(function(_j) {
			// 图标对象变量
			var chart1, chart2, chart3, chart4;
			
			// 图标1
			function initC1Chart() {
				_j("#c1").html("<p style='line-height: 315px;text-align: center;'>Loading...</p>");
				_j.post("${rc.contextPath}/localData/status-code-statistics.do", {
					startDate: $("#startDate").val(),
					endDate: $("#endDate").val(),
					city: $("#city").val()
				}, function(result) {
					if (result.status) {
						_j("#c1").html("");
						var data = result.list;
						var Stat = G2.Stat;
						chart1 = new G2.Chart({
							id : 'c1',
							forceFit : true,
							height : 320,
							plotCfg : {
								margin : [ 50, 50, 100, 50 ]
							}
						});
						chart1.legend('name', {
							position : 'bottom',
							spacingX : 50,
							title : null,
							itemWrap : true,
							marker : 'square',
							dy : 18
						});
						chart1.legend('type', {
							position : 'top',
							title : null,
							itemWrap : true,
							marker : 'square',
							dy : 0
						});
						var viewBack = chart1.createView();
						viewBack.source(data);
						viewBack.coord('theta', {
							radius : .7
						});
						// 绘制内部的饼图
						viewBack.intervalStack().position(Stat.summary.percent('value')).color('type', [ '#4ecda5', '#c82b3d' ]);
						// 绘制外圈饼图
						var view = chart1.createView();
						view.source(data);
						view.coord('theta', {
							inner : 0.78
						});
						view.intervalStack().position(Stat.summary.percent('value')).color('name').selected({
							mode : 'multiple'
						});
						chart1.render();
					} else {
						_j("#c1").html("<p style='line-height: 315px;text-align: center;'>无数据</p>");
					}
				}, "json");
			}

			// 图标2
			function initC2Chart() {
				_j("#c2").html("<p style='line-height: 315px;text-align: center;'>Loading...</p>");
				_j.post("${rc.contextPath}/localData/back-dspeed-statistics.do", {
					startDate: $("#startDate").val(),
					endDate: $("#endDate").val(),
					city: $("#city").val()
				}, function(result){
		    		if(result.status) {
		    			_j("#c2").html("");
						var Frame = G2.Frame;
				        var frame = new Frame(result.list);
				        frame = Frame.combinColumns(frame, ['吐出流量', '回源流量'], 'value', 'type', 'date'); 
				        chart2 = new G2.Chart({
				          id: 'c2',
				          forceFit: true,
				          height: 320,
				          plotCfg: {
				            margin: [20, 90, 100,100]
				          }
				        });
				        chart2.source(frame, {
				          date: {
				            type: 'time',
				            mask: 'yyyy-mm-dd HH:MM'
				          },
				          value: {
				            alias: '速度 (Mpbs)'
				          }
				        });
				        chart2.legend({
				            position: 'bottom',
					    	marker: 'square',
					    	dy: 13
				        });
				        chart2.axis('date', {
					          tickLine: {
					            stroke: '#000',
					            value: 3 // 刻度线长度
					          },
					          line: {
					            stroke: '#000'
					          },
					          title: null,
					         formatter: function(value) {
					            return value.split(" ")[1];
					         }
				        });
				        chart2.axis('value', {
				          tickLine: {
				            stroke: '#000',
				            value: 3 // 刻度线长度
				          },
				          labels: {
				            label: {
				              fill: '#000'
				            }
				          },
				          line: {
				            stroke: '#000'
				          },
				          grid: null
				        });
				        chart2.line().position('date*value').color('type', ['#1f77b4', '#ff7f0e']).shape('line').size(2);
				        chart2.render();
		    		} else {
						_j("#c2").html("<p style='line-height: 315px;text-align: center;'>无数据</p>");
					}
		    	}, "json");
			}

			// 图标3
			function initC3Chart() {
				_j("#c3").html("<p style='line-height: 255px;text-align: center;'>Loading...</p>");
				_j.post("${rc.contextPath}/localData/cache-stat-statistics.do", {
					startDate: $("#startDate").val(),
					endDate: $("#endDate").val(),
					city: $("#city").val()
				}, function(result) {
					if (result.status) {
						_j("#c3").html("");
						var data = result.list;
					    var Stat = G2.Stat;
					    chart3 = new G2.Chart({
					          id: 'c3',
					          forceFit: true,
					          height: 260,
					          plotCfg: {
					            margin: [30, 50, 70, 50]
					          }
					      });
					    chart3.source(data);
					    chart3.coord('theta', {
					        radius: 0.8 // 设置饼图的大小
					      });
					    chart3.legend('name', {
					        position: 'bottom',
					    	marker: 'square'
					      });
					    chart3.tooltip({
					        title: null,
					        map: {
					          value: 'value'
					        }
					      });
					    chart3.intervalStack().position(Stat.summary.percent('value')).color('name').label('name*..percent',function(name, percent){
					        percent = (percent * 100).toFixed(2) + '%';
					        return name + ' ' + percent;
					      });
					    chart3.render();
					} else {
						_j("#c3").html("<p style='line-height: 255px;text-align: center;'>无数据</p>");
					}
				}, "json");
			}
			
			// 图标4
			function initC4Chart() {
				_j("#c4").html("<p style='line-height: 255px;text-align: center;'>Loading...</p>");
				_j.post("${rc.contextPath}/localData/cache-visit-ntps-statistics.do", {
					startDate: $("#startDate").val(),
					endDate: $("#endDate").val(),
					city: $("#city").val()
				}, function(result) {
					if (result.status) {
						var data = result.list;
		    			_j("#c4").html("");
		    			chart4 = new G2.Chart({
					        id: 'c4',
					        forceFit: true,
					        height: 260,
				            plotCfg: {
					            margin: [20, 50, 46, 90]
					        }
					      });
		    			chart4.source(data, {
					    	    date: {
							        mask: 'HH:MM:ss',
						            tickCount: 8
						        },
						        visitCount: {
						            alias: '访问次数'
						        }
					      });
		    			chart4.axis('date', {
					    	  title: null,
						        formatter: function(value) {
						            return value.split(" ")[1];
						        }
					      });
		    			chart4.line().position('date*visitCount').size(2);
		    			chart4.render();
					} else {
						_j("#c4").html("<p style='line-height: 255px;text-align: center;'>无数据</p>");
					}
				}, "json");
			}

			// 初始化图标
			function initChartData() {
				setTimeout(function(){
					initC1Chart();
					setTimeout(function(){
						initC2Chart();
						setTimeout(function(){
							initC3Chart();
							setTimeout(function(){
								initC4Chart();
							}, 100);
						}, 100);
					}, 100);
				}, 100);
			}
			
			// 加载数据
			initChartData();

			// 点击检索按钮
			_j("#searchBtn").on("click", function() {
				initChartData();
			});
			// 下载图标
			_j("#downChart1").on("click", function() {
				chart1.downloadImage();
			});
			_j("#downChart2").on("click", function() {
				chart2.downloadImage();
			});
			_j("#downChart3").on("click", function() {
				chart3.downloadImage();
			});
			_j("#downChart4").on("click", function() {
				chart4.downloadImage();
			});
			
			// 日期控件初始化
			$('#startDate').datetimepicker({
				locale: 'zh-cn',
				format: 'YYYY-MM-DD HH:mm:ss',
				maxDate: new Date(),
				useCurrent: false
            });
			$('#endDate').datetimepicker({
				locale: 'zh-cn',
				format: 'YYYY-MM-DD HH:mm:ss',
				maxDate: new Date(),
				useCurrent: false
            });
		})(jQuery)
	</script>
</body>
</html>